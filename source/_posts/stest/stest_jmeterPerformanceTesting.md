---
title: 性能测试基础总结(jmeter)
date: 2019-03-21 19:09:55
tags: 
- jmeter

categories:
- 软件测试

---

#### 性能测试基础

* 性能测试释义
    * 一种非功能性测试技术，旨在根据各种工作负载下的响应性和稳定性来确定系统的响应参数，以便衡量系统的各项性能指标，例如可伸缩性，可靠性
    和资源使用情况；一般是通过自动化测试工具模拟多种正常、峰值以及异常负载条件来进行测试
    
* 性能测试目的
    * 性能测试的目的是验证软件系统是否能够达到期望的性能指标，同时发现性能瓶颈，以优化软件，最后起到优化系统的目的。性能测试包括以下几个方面：
    
        * 评估系统能力：规划系统容量规模
        * 找到系统弱点：链路中成为瓶颈的中间件、数据库、应用服务（木桶理论）
        * 发现系统问题：由于环境、代码、数据等原因引起的请求失败、内存、CPU、IO异常乃至宕机
        * 性能调优：发现瓶颈后，提出优化方案、验证方案效果
        * 验证稳定性和可靠性：疲劳稳定性测试

* 性能测试常见分类：

    * 负载测试(Load testing)：测试系统在特定负载下的行为，或是为了获得系统开始降低其性能的收支平衡点
    
    * 压力测试(Stress Testing)：执行该测试以查找系统的上限容量，并确定当前负载远高于预期最大值时系统的性能
    
    * 持久测试(Endurance testing)：也被称为是浸泡测试(Soak Testing)，指在相当长的时间内使用预期的负载量对系统进行测试，以检查
      系统的各种行为，如内存泄露、系统错误、随机行为等
      
    * 尖峰测试(Spike testing)：其可以算作是压力测试(Stress Testing)的子集，短时间内在目标系统上反复增加工作负载，以至超出预期
      生产操作的负载量时，分析系统的行为，验证其性能特征
      
    * 容量测试(Volume testing)：容量测试是一种非功能的测试，它通过向应用程序中添加大量的数据来实现;通过容量测试，可以识别应用程序
      中具有大数据时的瓶颈，检查应用程序的效率，进而得到不同数据量级下应用程序的性能
      
    * 基准测试：通过设计合理的测试方法，选用合适的测试工具和被测系统，实现对某个特定目标场景的某项性能指标进行定量的和可对比的测试
      
    * 稳定性测试：通过给系统加载一定的业务压力，让系统持续运行一段时间（一般为7x24小时），以检测系统是否能够稳定运行
    
    * 
           
* 性能测试相关的常用术语

    * 事务：性能测试中，事务指的是从端到端，一个完整的操作过程，比如一次登录、一次筛选条件查询，一次支付等
    
    * 响应时间：是指用户从客户端发送请求到所有的请求都从服务器返回客户所经历的时间
    
    * 并发用户数：指"同一时刻"与服务器进行"数据交互"的所有用户数量(狭义上的并发)
      (PS:广义上的并发：多个用户与系统发生了数据交互，这些业务场景可以是相同的也可以是不同的，比如交叉请求和交叉处理)
    
    * 吞吐量：指在一次性能测试过程中网络传输的数据量总和，或者说在单次业务中，客户端与服务器端进行的数据交互总量
      (PS:对交互式应用来说，吞吐量指标反映服务器承受的压力，容量规划的测试中，吞吐量是重点关注的指标，它能够说明系统级别的负载能力，
      另外，在性能调优过程中，吞吐量指标也有重要的价值)
      
    * 吞吐率：吞吐量/传输时间，即单位时间内网络上传输的数据量，也可以指单位时间内处理客户请求数量，它是衡量网络性能的重要指标。
      通常情况下，吞吐率用“字节数/秒”来衡量，当然，也可以用“请求数/秒”和“页面数/秒”来衡量
      
    * TPS(Transaction Per Second)：每秒事务数，指服务器在单位时间内（秒）可以处理的事务数量，一般以request/second为单位
    
    * QPS(Query Per Second)：每秒查询率，指服务器在单位时间内（秒）处理的查询请求速率
    
    * 点击量、点击率：点击数指服务器收到的请求数(不同于用户的鼠标点击数)，点击率指单位时间内的请求数 
    
    * PV(Page View)：页面浏览量，通常是衡量一个页面甚至网站流量的重要指标
    
    * RT/ART(Response Time/average Response Time)：响应时间/平均响应时间，指一个事务花费多长时间完成；
      一般来说，性能测试中平均响应时间更有代表意义。细分的话，还有最小最大响应时间，50%、90%用户响应时间等  
      
    * Thinking Time：思考时间，在性能测试中，模拟用户的真实操作场景。用户操作的事务与事务之间是有一定间隔的，引入这个概念是为了
      并发测试（有交叉业务场景）时，业务场景比率更符合真实业务场景
      
    * 标准方差：指各数据偏离平均数的距离（离均差）的平均数，它能反应一个数据集的离散程度。离散程度越大，数据越不可靠
    
    * 资源使用率：资源指标与硬件资源消耗直接相关，而系统指标则与用户场景及需求直接相关，如下图所示
    
        ![](https://gitee.com/kolenj/BlogImages/raw/master/20200623111342.png)
        
        ![](https://gitee.com/kolenj/BlogImages/raw/master/20200623162742.png)
        
#### 性能测试中常见的指标说明
 
* 资源常见指标

    * CPU使用率：指用户进程与系统进程消耗的CPU时间百分比，长时间情况下，一般可接受上限不超过85%；

    * 内存利用率：内存利用率=（1-空闲内存/总内存大小）*100%，一般至少有10%可用内存，内存使用率可接受上限为85%；

    * 磁盘I/O: 磁盘主要用于存取数据，因此当说到IO操作的时候，就会存在两种相对应的操作，存数据的时候对应的是写IO操作，取数据的时候对应的是是读IO操作，一般使用% Disk Time
     （磁盘用于读写操作所占用的时间百分比）度量磁盘读写性能；

    * 网络带宽：一般使用计数器Bytes Total/sec来度量，其表示为发送和接收字节的速率，包括帧字符在内；判断网络连接速度是否是瓶颈，可以用该计数器的值和目前网络的带宽比较；     


* 系统常见指标

    * 并发用户数：单位时间内与系统发生交互的用户数；

    * 在线用户数：某段时间内访问系统的用户数，这些用户并不一定同时向系统提交请求；

    * 平均响应时间：系统处理事务的响应时间的平均值；事务的响应时间是从客户端提交访问请求到客户端接收到服务器响应所消耗的时间；

    * 事务成功率：性能测试中，定义事务用于度量一个或者多个业务流程的性能指标，如用户登录、保存订单、提交订单操作均可定义为事务，单位时间内系统可以成功完成多少个定义的事务，
      在一定程度上反应了系统的处理能力，一般以事务成功率来度量；

    * 超时错误率：主要指事务由于超时或系统内部其它错误导致失败占总事务的比率；


* 数据库常见指标

    * 主要包括SQL、吞吐量、缓存命中率、连接数等，具体如下图所示：
    
    ![](https://gitee.com/kolenj/BlogImages/raw/master/20200623163739.png)


#### 性能测试中常用的应用场景和测试方法

* 性能测试常用的应用场景有：能力验证、规划能力、性能调优、缺陷发现、基准性能比较，下图为这几个应用场景的用途和特点

    ![](https://gitee.com/kolenj/BlogImages/raw/master/20200623161304.png)
          
* 性能测试场景与其常用的测试方法如下图所示
  
    ![](https://gitee.com/kolenj/BlogImages/raw/master/20200623161729.png) 
    
    
#### 性能测试的准备、执行及调优

* 性能测试的准备、执行

    * 1、准备测试环境(系统的运行环境和执行机的运行环境)
    
    * 2、设计测试场景(根据性能需求分析设计符合用户使用习惯的场景)
    
    * 3、选择性能工具(根据需求选择相应的性能测试工具，比如：Jmeter/Load Runner及其他监控工具)
    
    * 4、准备测试脚本(如果性能测试工具不能满足被测系统的某些要求时，我们需自己开发脚本，结合测试工具进行性能测试)
    
    * 5、准备测试数据(比如模拟用户并发请求所需要的账户登录数据)  
    
    * 6、执行测试(人工边执行边分析/无人值守执行) 

* 性能测试的一般调优步骤
    
    * 1、确定问题，常见有以下几项：
    
        * 应用程序代码：在通常情况下，很多程序的性能问题都是写出来的，因此对于发现瓶颈的模块，应该首先检查一下代码
        
        * 数据库配置：经常引起整个系统运行缓慢，一些诸如oracle 的大型数据库都是需要DBA进行正确的参数调整才能投产的
        
        * 操作系统配置：不合理就可能引起系统瓶颈
        
        * 硬件设置：硬盘速度、内存大小等都是容易引起瓶颈的原因(分析的重点)
        
        * 网络：网络负载过重导致网络冲突和网络延迟
    
    * 2、确定原因
    
    * 3、确定调整目标和解决方案(提高系统吞吐量，缩短响应时间，更好地支持并发)
    
    * 4、测试解决方案(对通过解决方案调优后的系统进行基准测试)
    
    * 5、分析调优结果
    
* 寻找性能问题的思路总结

    *  查找瓶颈时可以由易到难顺序尝试
        
        * 服务器硬件瓶颈---〉网络瓶颈（局域网，可以不考虑）---〉服务器操作系统瓶颈（参数配置）---〉中间件瓶颈（参数配置，
          数据库，web服务器等）---〉应用瓶颈（SQL语句、数据库设计、业务逻辑、算法等）
          
    * 使用(分段/模块)排除法
